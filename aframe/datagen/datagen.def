Bootstrap: docker
From: mambaorg/micromamba:1.5
Stage: build

%files
../.. /opt/aframe

%post
mkdir -p /cvmfs /hdfs /gpfs /ceph /hadoop
mamba create -n aframe -f /opt/aframe/datagen/conda-lock.yaml
mamba run -n aframe python -m pip install --no-dependencies \
    torchtyping>=0.1 \
    -e /opt/aframe/ml4gw \
    -e /opt/aframe/aframe/utils \
    -e /opt/aframe/mldatafind

%runscript
. /opt/conda/etc/profile.d/conda.sh
conda activate aframe-datagen
exec "$@" 
